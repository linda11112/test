<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thế Giới Tu Luyện 2D (Demo)</title>
    <style>
        body {
            background-color: #1f2937; /* Màu nền tối */
            color: #d1d5db;
            font-family: 'VT323', monospace; /* Giữ font pixel */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        canvas {
            border: 4px solid #4b5563; /* Giữ viền pixel */
            background-color: #111827; /* Nền canvas */
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
</head>
<body>
    <h1 style="font-size: 2rem; color: #fcd34d;">HÀNH TRÌNH VÔ THƯỢNG (Bản 2D Demo)</h1>
    
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script>
        // --- 1. LẤY CANVAS VÀ CONTEXT ---
        const canvas = document.getElementById('gameCanvas');
        // "context" (ctx) là công cụ để chúng ta vẽ lên canvas
        const ctx = canvas.getContext('2d');

        // --- 2. GAME STATE (TRẠNG THÁI GAME) ---
        // Giữ lại một phần gameState của bạn để minh họa
        let gameState = {
            realmIndex: 1, // Luyện Khí Tầng 1
            experience: 500,
            spiritStone: 1000,
            currentHP: 80,
            maxHP: 100
        };

        // Thêm trạng thái 2D cho nhân vật
        let player = {
            x: 400, // Tọa độ x
            y: 300, // Tọa độ y
            width: 32, // Chiều rộng
            height: 48, // Chiều cao
            color: '#ef4444', // Màu đỏ (thay bằng hình ảnh sau)
            speed: 5,
            velX: 0, // Vận tốc x
            velY: 0  // Vận tốc y
        };

        // --- 3. XỬ LÝ ĐẦU VÀO (BÀN PHÍM) ---
        let keys = {}; // Lưu trạng thái các phím đang được nhấn
        
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true; // Phím đang được nhấn
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false; // Phím đã được thả
        });

        // --- 4. HÀM UPDATE (CẬP NHẬT LOGIC) ---
        function update() {
            // Cập nhật vận tốc dựa trên phím nhấn
            player.velX = 0;
            player.velY = 0;

            if (keys['ArrowUp'] || keys['w']) {
                player.velY = -player.speed;
            }
            if (keys['ArrowDown'] || keys['s']) {
                player.velY = player.speed;
            }
            if (keys['ArrowLeft'] || keys['a']) {
                player.velX = -player.speed;
            }
            if (keys['ArrowRight'] || keys['d']) {
                player.velX = player.speed;
            }

            // Cập nhật vị trí nhân vật
            player.x += player.velX;
            player.y += player.velY;

            // Ngăn nhân vật đi ra ngoài màn hình
            if (player.x < 0) player.x = 0;
            if (player.y < 0) player.y = 0;
            if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
            if (player.y + player.height > canvas.height) player.y = canvas.height - player.height;

            // ----- TÍCH HỢP LOGIC CŨ CỦA BẠN -----
            // Đây là nơi bạn có thể chạy logic tọa thiền
            // Ví dụ: (chạy 1 lần mỗi giây thay vì mỗi khung hình)
            // if (gameTick % 60 === 0) { // 60 khung hình ~ 1 giây
            //    gameState.experience += 10;
            // }
        }

        // --- 5. HÀM DRAW (VẼ ĐỒ HỌA) ---
        function draw() {
            // Xóa toàn bộ canvas trước khi vẽ khung hình mới
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Vẽ nền (nếu có)
            ctx.fillStyle = '#111827';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // VẼ NHÂN VẬT (hiện tại là hình vuông)
            // Sau này bạn sẽ dùng: ctx.drawImage(playerImage, player.x, player.y)
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);
            
            // VẼ GIAO DIỆN (UI)
            // Đây là nơi bạn thay thế logic updateUI()
            ctx.font = '24px VT323';
            ctx.fillStyle = '#d1d5db';
            
            // Vẽ Cảnh giới (ví dụ)
            const realmName = "Luyện Khí Tầng 1"; // Lấy từ REALMS[gameState.realmIndex].name
            ctx.fillText(`Cảnh Giới: ${realmName}`, 10, 30);
            
            // Vẽ Linh Thạch
            ctx.fillStyle = '#fcd34d'; // Màu vàng
            ctx.fillText(`Linh Thạch: ${gameState.spiritStone.toLocaleString()}`, 10, 60);

            // Vẽ thanh HP
            const hpPercent = gameState.currentHP / gameState.maxHP;
            ctx.fillStyle = '#4b5563'; // Nền thanh HP
            ctx.fillRect(10, 80, 200, 20);
            ctx.fillStyle = '#ef4444'; // Màu HP (đỏ)
            ctx.fillRect(10, 80, 200 * hpPercent, 20);
            ctx.fillStyle = '#ffffff'; // Chữ trắng
            ctx.fillText(`${gameState.currentHP} / ${gameState.maxHP}`, 80, 98);
        }

        // --- 6. GAME LOOP (VÒNG LẶP CHÍNH) ---
        function gameLoop() {
            // 1. Cập nhật logic game
            update();
            
            // 2. Vẽ lại mọi thứ
            draw();
            
            // 3. Yêu cầu trình duyệt gọi lại hàm này ở khung hình tiếp theo
            requestAnimationFrame(gameLoop);
        }

        // --- KHỞI ĐỘNG GAME ---
        // (Bạn có thể thêm hàm tải hình ảnh, âm thanh... ở đây trước khi bắt đầu)
        console.log("Bắt đầu Game Loop...");
        gameLoop(); // Bắt đầu vòng lặp

    </script>
</body>
</html>
